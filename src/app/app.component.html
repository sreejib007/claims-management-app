<!-- Full Screen Loading Skeleton -->
<app-loading-screen [isLoading]="isLoading"></app-loading-screen>

<div class="d-flex flex-column min-vh-100" *ngIf="!isLoading">
  <app-header
    (chatbotClick)="openChatbot()"
    (claimSelect)="onGlobalClaimSelect($event)"
    (policySelect)="onGlobalPolicySelect($event)"
    (handlerSelect)="onGlobalHandlerSelect($event)">
  </app-header>
  <div class="d-flex flex-grow-1">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <ul class="nav-list">
          <li *ngFor="let item of menuItems"
              class="nav-item"
              [class.active]="activeMenu === item.id"
              (click)="selectMenu(item.id)">
            <i [class]="item.icon"></i>
            <span class="nav-label">{{ item.label }}</span>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content flex-grow-1 p-3">
      <!-- Claims Dashboard -->
      <div *ngIf="activeMenu === 'dashboard'">
        <app-dashbord (newClaimClick)="openClaimWizard()"></app-dashbord>
      </div>

      <!-- Claims -->
      <div *ngIf="activeMenu === 'claims'">
        <app-claims></app-claims>
      </div>

      <!-- Policies -->
      <div *ngIf="activeMenu === 'policies'">
        <app-policies class="w-100"></app-policies>
      </div>

      <!-- Handlers -->
      <div *ngIf="activeMenu === 'handlers'">
        <app-handlers class="w-100" (newClaimClick)="openClaimWizard()"></app-handlers>
      </div>
    </main>
  </div>
  <app-footer></app-footer>

  <!-- Floating Action Buttons -->
  <div class="fab-container">
    <button
      pButton
      type="button"
      class="fab-button fab-chat"
      icon="pi pi-comment"
      pTooltip="AI Assistant"
      tooltipPosition="left"
      (click)="openChatbot()"
    ></button>
    <button
      pButton
      type="button"
      class="fab-button fab-new"
      icon="pi pi-plus"
      pTooltip="New Claim"
      tooltipPosition="left"
      (click)="openClaimWizard()"
    ></button>
  </div>

  <!-- New Claim Wizard Drawer -->
  <app-new-claim-wizard
    [(isOpen)]="isClaimWizardOpen"
    (claimCreated)="onClaimCreated($event)"
  ></app-new-claim-wizard>

  <!-- AI Chatbot Drawer -->
  <app-ai-chatbot [(isOpen)]="isChatbotOpen"></app-ai-chatbot>

  <!-- Global Search Detail Drawers -->
  <app-claim-detail
    [(isOpen)]="isClaimDetailOpen"
    [claimId]="selectedClaimId"
    (isOpenChange)="closeClaimDetail()">
  </app-claim-detail>

  <app-policy-detail
    [(isOpen)]="isPolicyDetailOpen"
    [policyId]="selectedPolicyId"
    (isOpenChange)="closePolicyDetail()">
  </app-policy-detail>

  <app-handler-detail
    [(isOpen)]="isHandlerDetailOpen"
    [handlerId]="selectedHandlerId"
    (isOpenChange)="closeHandlerDetail()">
  </app-handler-detail>
</div>
